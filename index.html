<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BekoBook ‚Äî —Å–æ—Ü—Å–µ—Ç—å</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 20px auto;
    background: #f0f0f0;
    color: #222;
  }
  #loginForm, #registerForm, #profile, #postsSection, #chatSection {
    background: white;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 0 5px #ccc;
  }
  input, textarea, button {
    font-size: 16px;
    padding: 8px;
    margin: 5px 0;
    width: 100%;
    box-sizing: border-box;
  }
  button {
    cursor: pointer;
    background: #2979ff;
    color: white;
    border: none;
    border-radius: 5px;
  }
  button:hover {
    background: #0d47a1;
  }
  .post, .message {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 8px;
    margin-bottom: 8px;
    background: #fafafa;
  }
  .post-author {
    font-weight: bold;
    margin-bottom: 5px;
  }
  .post-likes {
    font-size: 14px;
    color: #555;
  }
  #usersList {
    max-height: 100px;
    overflow-y: auto;
    border: 1px solid #ccc;
    margin-bottom: 10px;
    padding: 5px;
  }
  #usersList div {
    cursor: pointer;
    padding: 4px;
    border-bottom: 1px solid #ddd;
  }
  #usersList div:hover {
    background-color: #ddd;
  }
</style>
</head>
<body>

<h1>BekoBook ‚Äî —Å–æ—Ü—Å–µ—Ç—å</h1>

<div id="authSection">
  <div id="loginForm">
    <h2>–í—Ö–æ–¥</h2>
    <input type="text" id="loginLogin" placeholder="–õ–æ–≥–∏–Ω" />
    <input type="password" id="loginPass" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button id="loginBtn">–í–æ–π—Ç–∏</button>
    <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <button id="showRegisterBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></p>
    <p id="loginError" style="color:red;"></p>
  </div>

  <div id="registerForm" style="display:none;">
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input type="text" id="registerLogin" placeholder="–õ–æ–≥–∏–Ω" />
    <input type="password" id="registerPass" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button id="registerBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <p>–ï—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <button id="showLoginBtn">–í—Ö–æ–¥</button></p>
    <p id="registerError" style="color:red;"></p>
  </div>
</div>

<div id="mainSection" style="display:none;">
  <div id="profile">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å: <span id="profileName"></span></h2>
    <button id="logoutBtn">–í—ã–π—Ç–∏</button>
  </div>

  <div id="createPostSection">
    <h3>–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</h3>
    <textarea id="postText" rows="3" placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..."></textarea>
    <button id="createPostBtn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
  </div>

  <div id="postsSection">
    <h3>–ü–æ—Å—Ç—ã</h3>
    <div id="postsList"></div>
  </div>

  <div id="chatSection">
    <h3>–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
    <div id="usersList"></div>
    <textarea id="messageText" rows="2" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
    <button id="sendMessageBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="messagesList"></div>
  </div>
</div>

<script src="data.js"></script>
<script>
  const loginForm = document.getElementById("loginForm");
  const registerForm = document.getElementById("registerForm");
  const showRegisterBtn = document.getElementById("showRegisterBtn");
  const showLoginBtn = document.getElementById("showLoginBtn");
  const loginError = document.getElementById("loginError");
  const registerError = document.getElementById("registerError");

  showRegisterBtn.onclick = () => {
    loginForm.style.display = "none";
    registerForm.style.display = "block";
    loginError.textContent = "";
  };

  showLoginBtn.onclick = () => {
    registerForm.style.display = "none";
    loginForm.style.display = "block";
    registerError.textContent = "";
  };

  const loginLogin = document.getElementById("loginLogin");
  const loginPass = document.getElementById("loginPass");
  const loginBtn = document.getElementById("loginBtn");

  const registerLogin = document.getElementById("registerLogin");
  const registerPass = document.getElementById("registerPass");
  const registerBtn = document.getElementById("registerBtn");

  const authSection = document.getElementById("authSection");
  const mainSection = document.getElementById("mainSection");
  const profileName = document.getElementById("profileName");
  const logoutBtn = document.getElementById("logoutBtn");
  const postText = document.getElementById("postText");
  const createPostBtn = document.getElementById("createPostBtn");
  const postsList = document.getElementById("postsList");

  const usersList = document.getElementById("usersList");
  const messageText = document.getElementById("messageText");
  const sendMessageBtn = document.getElementById("sendMessageBtn");
  const messagesList = document.getElementById("messagesList");

  let currentChatUser = null;

  function updateUI() {
    if (getLoggedInUser()) {
      authSection.style.display = "none";
      mainSection.style.display = "block";
      profileName.textContent = getLoggedInUser();
      refreshPosts();
      refreshUsersList();
      refreshMessages();
    } else {
      authSection.style.display = "block";
      mainSection.style.display = "none";
    }
  }

  loginBtn.onclick = () => {
    const login = loginLogin.value.trim();
    const pass = loginPass.value;
    if (loginUser(login, pass)) {
      loginError.textContent = "";
      loginLogin.value = "";
      loginPass.value = "";
      updateUI();
    } else {
      loginError.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!";
    }
  };

  registerBtn.onclick = () => {
    const login = registerLogin.value.trim();
    const pass = registerPass.value;
    if (!login || !pass) {
      registerError.textContent = "–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!";
      return;
    }
    if (registerUser(login, pass)) {
      registerError.style.color = "green";
      registerError.textContent = "–£—Å–ø–µ—à–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.";
      registerLogin.value = "";
      registerPass.value = "";
    } else {
      registerError.style.color = "red";
      registerError.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!";
    }
  };

  logoutBtn.onclick = () => {
    logoutUser();
    updateUI();
  };

  createPostBtn.onclick = () => {
    const text = postText.value.trim();
    if (!text) return alert("–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞!");
    createPost(text);
    postText.value = "";
    refreshPosts();
  };

  function refreshPosts() {
    postsList.innerHTML = "";
    const posts = getAllPosts();
    if (posts.length === 0) postsList.textContent = "–ü–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.";
    else {
      posts.forEach(post => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <div class="post-author">${post.author}</div>
          <div>${post.text}</div>
          <div class="post-likes">–õ–∞–π–∫–æ–≤: ${post.likes} <button data-id="${post.id}">üëç</button></div>
        `;
        const likeBtn = div.querySelector("button");
        likeBtn.onclick = () => {
          if(likePost(post.id)) refreshPosts();
          else alert("–í—ã —É–∂–µ –ª–∞–π–∫–∞–ª–∏ —ç—Ç–æ—Ç –ø–æ—Å—Ç!");
        };
        postsList.appendChild(div);
      });
    }
  }

  function refreshUsersList() {
    usersList.innerHTML = "";
    const allUsers = getAllUserLogins().filter(u => u !== getLoggedInUser());
    if(allUsers.length === 0) usersList.textContent = "–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π";
    else {
      allUsers.forEach(user => {
        const div = document.createElement("div");
        div.textContent = user;
        div.onclick = () => {
          currentChatUser = user;
          refreshMessages();
        };
        usersList.appendChild(div);
      });
    }
  }

  sendMessageBtn.onclick = () => {
    if(!currentChatUser) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è!");
    const text = messageText.value.trim();
    if(!text) return alert("–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!");
    if(sendMessage(currentChatUser, text)) {
      messageText.value = "";
      refreshMessages();
    } else {
      alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è");
    }
  };

  function refreshMessages() {
    messagesList.innerHTML = "";
    if (!currentChatUser) {
      messagesList.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±—â–µ–Ω–∏—è";
      return;
    }
    const messages = getUserMessages()[currentChatUser] || [];
    if (messages.length === 0) messagesList.textContent = "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π";
    else {
      messages.forEach(m => {
        const div = document.createElement("div");
        div.className = "message";
        div.textContent = `${currentChatUser} [${new Date(m.date).toLocaleString()}]: ${m.text}`;
        messagesList.appendChild(div);
      });
    }
  }

  updateUI();
</script>

</body>
</html>
